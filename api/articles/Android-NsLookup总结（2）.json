{"title":"Android-NsLookup总结（2）","slug":"Android-NsLookup总结（2）","date":"2018-09-02T02:09:39.000Z","updated":"2018-12-07T08:28:47.647Z","comments":true,"excerpt":"","content":"<p>这次较上次的总结中新增了可以copy IP的功能，对文本框中现有的数据进行捕获并且进行处理（将查询信息中的格式解析成回行，让信息一条一条显示出来），只截取信息中的ip然后将其复制到系统剪切板，并且可以调用浏览器进行直接访问。</p>\n<h3 id=\"对查询信息中的文字处理\"><a href=\"#对查询信息中的文字处理\" class=\"headerlink\" title=\"对查询信息中的文字处理\"></a>对查询信息中的文字处理</h3><p>原本的信息中格式中有大量无用空格，这里将空格替换为回车<br>在上篇主函数showDnsIp（）中对return的ip进行处理，把一个以上的空格全部替换为“\\n”回车<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//将查询结果中的空格替换为回行</span><br><span class=\"line\">          ip = rec.toString().replaceAll(&quot;\\\\s+&quot;,&quot;\\n&quot;);</span><br></pre></td></tr></table></figure></p>\n<p>格式如下图<br><img src=\"https://upload-images.jianshu.io/upload_images/13139591-c36aee5ec35bf603.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"ns-msg-type.png\"><br>当点击copy按钮时，会弹出dialog</p>\n<h3 id=\"copy-ip的对话框\"><a href=\"#copy-ip的对话框\" class=\"headerlink\" title=\"copy ip的对话框\"></a>copy ip的对话框</h3><p><img src=\"https://upload-images.jianshu.io/upload_images/13139591-ea06deea304ff126.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"copy_ip_dialog.png\"><br>捕获字符串中的=ip并且将ip回传，因为用的java包中的函数查询出的格式为域名+端口号+in+查询类型+ip地址所以用数组可以把ip取出来。<br>用‘\\n’把字符串切割成字符串数组可以把ip取出来，对应的其他错误格式则用字幕显示no ip fond。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * 处理查询结果</span><br><span class=\"line\"> * 获取字符串中ip</span><br><span class=\"line\"> */</span><br><span class=\"line\">public String copyIp(String address)&#123;</span><br><span class=\"line\">    String [] ip;</span><br><span class=\"line\">    String errorIp=&quot;Error：&quot;;</span><br><span class=\"line\">    String nullIP=&quot;Please enter domain name&quot;;</span><br><span class=\"line\">    //利用数组取出查询结果中的ip，回传ip，没有ip则回传空字符</span><br><span class=\"line\">    if (address.contains(errorIp)||address.equals(&quot;&quot;)||address.equals(nullIP))&#123;</span><br><span class=\"line\">        ip= new String[]&#123;&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;&#125;;</span><br><span class=\"line\">    &#125;else &#123;</span><br><span class=\"line\">        ip=address.split(&quot;\\n&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    //格式：ip[0]域名,ip[1]端口号,ip[3]查询类型,ip[4]ip地址</span><br><span class=\"line\">    return ip[4];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>dialog的显示<br>设置好dialog的标题和内容，点击ok可以去粘贴，点击Open this url则调用默认的浏览器将ip打开。<br>其中访问浏览器需要用到intent，这里可以拓展为用户选定浏览器。记住dialog需要跟Toast一样最后要用.crate()和.show()将dialog显示<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\">    *显示ip复制的dialog</span><br><span class=\"line\">    */</span><br><span class=\"line\">   public void showIpDialog(String mIp)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">       AlertDialog.Builder mDialog=new AlertDialog.Builder(mAllActivity);</span><br><span class=\"line\">       mDialog.setMessage(&quot;You&apos;ve copied this IP:\\n&quot;+&quot;\\t&quot;+mIp);</span><br><span class=\"line\">       mDialog.setTitle(R.string.nslookup_dialog_title);</span><br><span class=\"line\">       //点击ok关闭对话框</span><br><span class=\"line\">       mDialog.setPositiveButton(&quot;ok&quot;, new DialogInterface.OnClickListener() &#123;</span><br><span class=\"line\">           @Override</span><br><span class=\"line\">           public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class=\"line\">               dialog.cancel();</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;);</span><br><span class=\"line\">       //点击左边按钮访问ip</span><br><span class=\"line\">       mDialog.setNegativeButton(&quot;Open this url&quot;, new DialogInterface.OnClickListener() &#123;</span><br><span class=\"line\">           @Override</span><br><span class=\"line\">           public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class=\"line\">               //访问复制到的ip</span><br><span class=\"line\">               Intent localIntent = new Intent(Intent.ACTION_VIEW, Uri.parse(&quot;http://&quot; + mIp));</span><br><span class=\"line\">               mAllActivity.startActivity(localIntent);</span><br><span class=\"line\">               dialog.cancel();</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;);</span><br><span class=\"line\">       mDialog.create();</span><br><span class=\"line\">       mDialog.show();</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"点击按钮时copy-Ip，并且弹出dialog\"><a href=\"#点击按钮时copy-Ip，并且弹出dialog\" class=\"headerlink\" title=\"点击按钮时copy Ip，并且弹出dialog\"></a>点击按钮时copy Ip，并且弹出dialog</h3><p>首先判断接到的信息是什么，若是字符串则显示字幕no ip fond，不是则将ip复制到剪切板并且创建dialog。<br>获取系统剪切板则需要使用到ClipboardManager剪切板管理器，用的时候创建对象并且赋值<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mCopyButton.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class=\"line\">           /**</span><br><span class=\"line\">            * 点击按钮复制ip</span><br><span class=\"line\">            * @param v</span><br><span class=\"line\">            */</span><br><span class=\"line\">           @Override</span><br><span class=\"line\">           public void onClick(View v) &#123;</span><br><span class=\"line\">               //复制ip并且显示复制ip的dialog</span><br><span class=\"line\">               String ip=copyIp(mTextView.getText().toString());</span><br><span class=\"line\">               if (ip.equals(&quot;&quot;))&#123;</span><br><span class=\"line\">                   Toast.makeText(mServerMonitor,R.string.nslookup_toast_msg,Toast.LENGTH_SHORT).show();</span><br><span class=\"line\">               &#125;else &#123;</span><br><span class=\"line\">                   //获取到剪贴板管理器</span><br><span class=\"line\">                   ClipboardManager mClipboardManager=(ClipboardManager)mAllActivity.</span><br><span class=\"line\">                           getSystemService(Context.CLIPBOARD_SERVICE);</span><br><span class=\"line\">                   //创建普通字符型ClipData</span><br><span class=\"line\">                   ClipData mClipData=ClipData.newPlainText(&quot;Lable&quot;,ip);</span><br><span class=\"line\">                   //放到系统剪切板</span><br><span class=\"line\">                   mClipboardManager.setPrimaryClip(mClipData);</span><br><span class=\"line\">                   showIpDialog(ip);</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               Log.d(&quot;---复制信息---&quot;+ip);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;);</span><br></pre></td></tr></table></figure></p>\n<p>这次算是对上次的域名查询功能上面做了一些补充，学习了一下Android中的使用浏览器访问ip和系统剪切板的使用。马上就要开学了，这个学年要学习更多东西，丰富自己努力提升。</p>\n","thumbnail":"/img/sheep.jpg","categories":[{"name":"Android","path":"api/categories/Android.json"}],"tags":[{"name":"Android","path":"api/tags/Android.json"},{"name":"DNS","path":"api/tags/DNS.json"}]}